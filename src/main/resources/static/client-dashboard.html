<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xmile - דשבורד לקוח עסקי</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="client-dashboard-style.css" rel="stylesheet">
    <link href="css/chatbot-widget.css" rel="stylesheet">
</head>
<body>
    <!-- Main Content (NEW LAYOUT) -->
    <main class="xm-layout">
      <!-- Sidebar -->
      <aside class="xm-sidebar">
        <div class="xm-brand">
          <img src="/assets/images/xmile-logo.png"
               alt="XMILE"
               class="xm-brand-logo" />
        </div>

        <nav class="xm-nav">
          <a class="xm-nav-item active" href="/client-dashboard.html">
            <i class="fas fa-home"></i><span>Dashboard</span>
          </a>
          <a class="xm-nav-item" href="/events.html">
            <i class="fas fa-calendar"></i><span>Events</span>
          </a>
          <a class="xm-nav-item" href="/participants.html">
            <i class="fas fa-users"></i><span>Participants</span>
          </a>
          <a class="xm-nav-item" href="/attendance-confirmation.html">
            <i class="fas fa-check-circle"></i><span>Attendance Confirmation</span>
          </a>
          <a class="xm-nav-item" href="/client-campaign-builder.html">
            <i class="fas fa-wand-magic-sparkles"></i><span>AI Marketing</span>
          </a>
          <a class="xm-nav-item" href="/templates.html">
            <i class="fas fa-layer-group"></i><span>Templates</span>
          </a>
          <a class="xm-nav-item" href="/analytics.html">
            <i class="fas fa-chart-line"></i><span>Analytics</span>
          </a>
        </nav>

        <div class="xm-sidebar-footer">
          <div class="xm-user-mini">
            <div class="xm-user-avatar"><span id="xmUserInitials">SJ</span></div>
            <div class="xm-user-meta">
              <div class="xm-user-name" id="xmUserNameMini">Client</div>
              <div class="xm-user-email" id="xmUserEmailMini">—</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Content -->
      <section class="xm-content">
        <!-- Topbar -->
        <div class="xm-topbar">
          <div class="xm-search">
            <i class="fas fa-search"></i>
            <input id="xmSearch" type="text" placeholder="Search events, participants..." />
          </div>

          <div class="xm-top-actions">
            <div class="xm-user-menu">
              <button class="xm-user-btn" type="button" id="xmUserMenuBtn">
                <span class="xm-user-chip" id="xmUserChip">SJ</span>
                <span class="xm-user-label" id="xmUserLabel">Client</span>
                <i class="fas fa-chevron-down"></i>
                <span class="xm-dot" id="xmNotifDot"></span>
              </button>

              <div class="xm-user-dropdown" id="xmUserDropdown">
                <button class="xm-dd-item" type="button" onclick="window.location.href='/client-profile.html'">
                  <i class="fas fa-user"></i> Profile
                </button>
                <button class="xm-dd-item" type="button" onclick="window.location.href='/settings.html'">
                  <i class="fas fa-gear"></i> Settings
                </button>
                <button class="xm-dd-item" type="button" onclick="window.location.href='/notifications.html'">
                  <i class="fas fa-bell"></i> Notifications
                </button>
                <div class="xm-dd-sep"></div>
                <button class="xm-dd-item danger" type="button" onclick="logout()">
                  <i class="fas fa-sign-out-alt"></i> Logout
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Welcome Section -->
        <div class="xm-welcome">
          <div class="xm-welcome-text">
            <h1>Welcome back, <span id="welcomeUser">Client</span></h1>
            <p>Here's what's happening with your events today.</p>
          </div>

          <div class="xm-welcome-actions">
            <button class="xm-btn-outline" onclick="window.location.href='/events.html'">
              <i class="fas fa-calendar"></i> View Events
            </button>
            <button class="xm-btn-primary" onclick="window.location.href='/attendance-confirmation.html'">
              <i class="fas fa-envelope"></i> Send Confirmations
            </button>
          </div>
        </div>

        <!-- KPI Cards -->
        <div class="xm-kpis">
          <div class="xm-kpi">
            <div class="xm-kpi-top">
              <div class="xm-kpi-title">Active Events</div>
              <div class="xm-kpi-icon xm-i-mint"><i class="fas fa-calendar"></i></div>
            </div>
            <div class="xm-kpi-value" id="kpiActiveEvents">0</div>
            <div class="xm-kpi-sub" id="kpiActiveEventsSub">—</div>
          </div>

          <div class="xm-kpi">
            <div class="xm-kpi-top">
              <div class="xm-kpi-title">Total Participants</div>
              <div class="xm-kpi-icon xm-i-blue"><i class="fas fa-users"></i></div>
            </div>
            <div class="xm-kpi-value" id="kpiTotalParticipants">0</div>
            <div class="xm-kpi-sub" id="kpiTotalParticipantsSub">—</div>
          </div>

          <div class="xm-kpi">
            <div class="xm-kpi-top">
              <div class="xm-kpi-title">Confirmed</div>
              <div class="xm-kpi-icon xm-i-green"><i class="fas fa-check-circle"></i></div>
            </div>
            <div class="xm-kpi-value" id="kpiConfirmed">0</div>
            <div class="xm-kpi-sub" id="kpiConfirmedSub">—</div>
          </div>

          <div class="xm-kpi">
            <div class="xm-kpi-top">
              <div class="xm-kpi-title">Messages Sent</div>
              <div class="xm-kpi-icon xm-i-purple"><i class="fas fa-envelope"></i></div>
            </div>
            <div class="xm-kpi-value" id="kpiMessages">0</div>
            <div class="xm-kpi-sub" id="kpiMessagesSub">—</div>
          </div>
        </div>

        <!-- Grid Row -->
        <div class="xm-grid">
          <!-- Recent Events -->
          <div class="xm-card">
            <div class="xm-card-head">
              <div class="xm-card-title">Recent Events</div>
              <button class="xm-link" type="button" onclick="filterEvents('all')">View All →</button>
            </div>

            <div class="xm-list" id="xmRecentEvents">
              <div class="xm-skeleton">טוען...</div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="xm-card">
            <div class="xm-card-head">
              <div class="xm-card-title">Quick Actions</div>
            </div>

            <div class="xm-actions">
              <button class="xm-action" type="button" onclick="openQuoteModal()">
                <i class="fas fa-plus"></i> Create New Event
              </button>

              <button class="xm-action" type="button" onclick="window.location.href='/participants.html'">
                <i class="fas fa-file-upload"></i> Upload Participants
              </button>

              <button class="xm-action" type="button" onclick="window.location.href='/attendance-confirmation.html'">
                <i class="fas fa-check"></i> Send Confirmations
              </button>

              <button class="xm-action" type="button" onclick="window.location.href='/client-campaign-builder.html'">
                <i class="fas fa-wand-magic-sparkles"></i> Create AI Campaign
              </button>
            </div>
          </div>

          <!-- Overall Confirmation -->
          <div class="xm-card xm-full">
            <div class="xm-card-head">
              <div class="xm-card-title">Overall Confirmation</div>
            </div>

            <div class="xm-progress-wrap">
              <div class="xm-progress-top">
                <div class="xm-muted">Progress</div>
                <div class="xm-strong"><span id="sumConfirmed">0</span>/<span id="sumTotal">0</span></div>
              </div>

              <div class="xm-progress">
                <div class="xm-progress-bar" id="xmProgressBar" style="width:0%"></div>
              </div>

              <div class="xm-triplets">
                <div class="xm-trip">
                  <div class="xm-trip-num xm-c-green" id="sumConfirmed2">0</div>
                  <div class="xm-trip-label">Confirmed</div>
                </div>
                <div class="xm-trip">
                  <div class="xm-trip-num xm-c-orange" id="sumPending">0</div>
                  <div class="xm-trip-label">Pending</div>
                </div>
                <div class="xm-trip">
                  <div class="xm-trip-num xm-c-red" id="sumDeclined">0</div>
                  <div class="xm-trip-label">Declined</div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </section>
    </main>

    <!-- Quote Request Modal -->
    <div class="modal fade" id="quoteModal" tabindex="-1" aria-labelledby="quoteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="quoteModalLabel">
                        <i class="fas fa-calculator"></i>
                        בדיקת הצעת מחיר לאירוע
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="quoteForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">שם האירוע *</label>
                                <input type="text" class="form-control" id="eventName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">מספר משתתפים *</label>
                                <input type="number" class="form-control" id="participantCount" min="1" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">מיקום האירוע *</label>
                                <input type="text" class="form-control" id="eventLocation" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">תאריך האירוע *</label>
                                <input type="date" class="form-control" id="eventDate" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">שעת התחלה *</label>
                                <input type="time" class="form-control" id="eventTime" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">חברת הפקה</label>
                                <select class="form-control" id="productionCompany">
                                    <option value="">החברה תציע שירות</option>
                                    <option value="1">חברת הפקה 1</option>
                                    <option value="2">חברת הפקה 2</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">הערות נוספות</label>
                            <textarea class="form-control" id="eventNotes" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-calculator"></i>
                                קבל הצעת מחיר
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Quote Result Modal -->
    <div class="modal fade" id="quoteResultModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle"></i>
                        הצעת מחיר התקבלה
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="quote-summary" id="quoteSummary">
                        <!-- Will be filled by JavaScript -->
                    </div>
                    
                    <div class="quote-actions mt-4">
                        <button class="btn btn-success w-100 mb-2" onclick="approveQuote()">
                            <i class="fas fa-check"></i>
                            מאשר את ההצעה
                        </button>
                        <button class="btn btn-outline-secondary w-100" data-bs-dismiss="modal">
                            חזור
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Representatives Modal -->
    <div class="modal fade" id="representativesModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-users"></i>
                        נציגי רישום נדרשים
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="representativesForm">
                        <div class="mb-3">
                            <label class="form-label">כמה נציגי רישום אתה צריך בקבלה ביום האירוע? *</label>
                            <input type="number" class="form-control" id="representativesCount" min="1" required>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            הבקשה תישלח לחברה לאישור
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i>
                                שלח לאישור
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-envelope"></i>
                        שליחת הודעה למשתתפים
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="message-wizard">
                        <!-- Step 1: Select Event -->
                        <div class="wizard-step active" id="step1">
                            <h6 class="step-title">בחר אירוע</h6>
                            <select class="form-control mb-3" id="selectedEvent">
                                <option value="">בחר אירוע...</option>
                            </select>
                            <button class="btn btn-primary" onclick="nextStep(2)">הבא</button>
                        </div>
                        
                        <!-- Step 2: Add Participants -->
                        <div class="wizard-step" id="step2">
                            <h6 class="step-title">הוסף משתתפים</h6>
                            <div class="participants-input mb-3">
                                <textarea class="form-control" id="participantsList" rows="5" 
                                    placeholder="הזן שמות משתתפים (שורה אחת לכל משתתף)&#10;או: שם, טלפון, אימייל"></textarea>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-secondary" onclick="prevStep(1)">חזור</button>
                                <button class="btn btn-primary" onclick="nextStep(3)">הבא</button>
                            </div>
                        </div>
                        
                        <!-- Step 3: AI Message Generation -->
                        <div class="wizard-step" id="step3">
                            <h6 class="step-title">
                                <i class="fas fa-magic"></i>
                                צור הודעה עם AI
                            </h6>
                            <div class="ai-message-section">
                                <div class="mb-3">
                                    <label class="form-label">תאר מה אתה רוצה לשלוח:</label>
                                    <textarea class="form-control" id="aiMessageRequest" rows="3" 
                                        placeholder="לדוגמה: הודעה מקצועית לאירוע עסקי, כוללת פרטי האירוע, מיקום, תאריך ושעה"></textarea>
                                </div>
                                <button class="btn btn-primary w-100 mb-4" onclick="generateAIMessages()">
                                    <i class="fas fa-magic"></i>
                                    צור 3 הצעות תוכן
                                </button>
                                
                                <div id="contentOptions" class="content-options" style="display: none;">
                                    <h6>בחר תוכן:</h6>
                                    <div class="options-grid" id="contentOptionsGrid"></div>
                                </div>
                                
                                <div id="designOptions" class="design-options mt-4" style="display: none;">
                                    <h6>בחר עיצוב:</h6>
                                    <div class="options-grid" id="designOptionsGrid"></div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between mt-4">
                                <button class="btn btn-secondary" onclick="prevStep(2)">חזור</button>
                                <button class="btn btn-primary" onclick="nextStep(4)" id="continueToSend" style="display: none;">
                                    המשך לשליחה
                                </button>
                            </div>
                        </div>
                        
                        <!-- Step 4: Send Message -->
                        <div class="wizard-step" id="step4">
                            <h6 class="step-title">שליחת הודעה</h6>
                            <div class="message-preview mb-3">
                                <div class="preview-card" id="messagePreview"></div>
                            </div>
                            <div class="send-options">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="sendEmail" checked>
                                    <label class="form-check-label" for="sendEmail">
                                        <i class="fas fa-envelope"></i>
                                        שלח במייל
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="sendSMS" checked>
                                    <label class="form-check-label" for="sendSMS">
                                        <i class="fas fa-sms"></i>
                                        שלח ב-SMS
                                    </label>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-secondary" onclick="prevStep(3)">חזור</button>
                                <button class="btn btn-success" onclick="sendMessages()">
                                    <i class="fas fa-paper-plane"></i>
                                    שלח הודעות
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/client-dashboard.js"></script>
    <script src="js/chatbot.js"></script>
</body>
</html>


<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>לוח בקרה - מנהל</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="css/common.css?v=1.0.3" rel="stylesheet">
    <link href="manager-dashboard.css?v=1.0.3" rel="stylesheet">
</head>
<body>
    <!-- Common Header -->
    <header class="common-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="logo-section">
                    <div class="logo-container">
                        <span class="logo-x">X</span>
                        <span class="logo-mile">mile</span>
                    </div>
                    <p class="logo-tagline">בית של פתרונות רישום</p>
                </div>
                <button class="btn-logout" id="logoutBtn" type="button" onclick="window.logout()">
                    <i class="fas fa-sign-out-alt"></i> התנתק
                </button>
            </div>
        </div>
    </header>

    <main class="container mt-4">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                    <i class="fas fa-clock"></i> בקשות לאישור
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                    <i class="fas fa-history"></i> היסטוריה
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">
                    <i class="fas fa-calendar"></i> אירועים
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="workers-tab" data-bs-toggle="tab" data-bs-target="#workers" type="button" role="tab">
                    <i class="fas fa-users"></i> עובדים
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="dashboardTabContent">
            <!-- Pending Quotes Tab -->
            <div class="tab-pane fade show active" id="pending" role="tabpanel">
                <div class="common-card">
                    <div class="common-card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-file-invoice-dollar"></i> הצעות מחיר ממתינות
                        </h5>
                    </div>
                    <div class="common-card-body">
                        <div id="quotesLoading" class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">טוען...</span>
                            </div>
                            <p class="mt-3 text-muted">טוען בקשות לאישור...</p>
                        </div>
                        <div id="quotesList" class="row g-3"></div>
                        <div id="quotesEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>אין בקשות ממתינות כרגע</p>
                        </div>
                        <div id="quotesError" class="error-message" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-pane fade" id="history" role="tabpanel">
                <div class="common-card">
                    <div class="common-card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-history"></i> היסטוריית הצעות מחיר
                        </h5>
                    </div>
                    <div class="common-card-body">
                        <!-- Filters -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">סטטוס</label>
                                <select class="form-control" id="historyStatusFilter">
                                    <option value="">הכל</option>
                                    <option value="APPROVED">אושר</option>
                                    <option value="REJECTED">נדחה</option>
                                    <option value="CANCELLED">בוטל</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">מתאריך</label>
                                <input type="date" class="form-control" id="historyDateFrom">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">עד תאריך</label>
                                <input type="date" class="form-control" id="historyDateTo">
                            </div>
                        </div>
                        <button class="btn-primary-action" onclick="loadHistoryQuotes()">
                            <i class="fas fa-filter"></i> סנן
                        </button>
                        
                        <div id="historyLoading" class="loading-spinner" style="display: none;">
                            <div class="spinner-border text-primary" role="status"></div>
                        </div>
                        <div id="historyList" class="row g-3 mt-3"></div>
                        <div id="historyEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>אין הצעות מחיר בהיסטוריה</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events Tab -->
            <div class="tab-pane fade" id="events" role="tabpanel">
                <div class="common-card">
                    <div class="common-card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar"></i> אירועים מאושרים
                        </h5>
                    </div>
                    <div class="common-card-body">
                        <div id="eventsLoading" class="loading-spinner">
                            <div class="spinner-border text-primary" role="status"></div>
                        </div>
                        <div id="eventsList" class="row g-3"></div>
                        <div id="eventsEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>אין אירועים מאושרים</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workers Tab -->
            <div class="tab-pane fade" id="workers" role="tabpanel">
                <div class="common-card">
                    <div class="common-card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-users"></i> ניהול עובדים
                        </h5>
                    </div>
                    <div class="common-card-body">
                        <div id="workersLoading" class="loading-spinner">
                            <div class="spinner-border text-primary" role="status"></div>
                        </div>
                        <div id="workersList" class="row g-3"></div>
                        <div id="workersEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>אין עובדים זמינים</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Approve Quote Modal -->
    <div class="modal fade" id="approveQuoteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle"></i> אישור הצעת מחיר
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="approveQuoteForm">
                        <input type="hidden" id="approveQuoteId">
                        <div class="mb-3">
                            <label class="form-label">פרטי האירוע</label>
                            <div id="approveQuoteDetails" class="border p-3 rounded bg-light"></div>
                        </div>
                        <div class="mb-3">
                            <label for="finalPrice" class="form-label">מחיר סופי (₪) *</label>
                            <input type="number" class="form-control" id="finalPrice" step="0.01" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="requestedWorkers" class="form-label">מספר עובדים נדרש *</label>
                            <input type="number" class="form-control" id="requestedWorkers" min="0" required>
                            <small class="form-text text-muted">מספר העובדים שיקבלו הצעות עבודה</small>
                        </div>
                        <div class="mb-3">
                            <label for="adminNotes" class="form-label">הערות מנהל</label>
                            <textarea class="form-control" id="adminNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-primary" id="saveApproveBtn">
                        <i class="fas fa-save"></i> אישר והגדר מחיר
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Quote Modal -->
    <div class="modal fade" id="rejectQuoteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-times-circle"></i> דחיית הצעת מחיר
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="rejectQuoteForm">
                        <input type="hidden" id="rejectQuoteId">
                        <div class="mb-3">
                            <label for="rejectReason" class="form-label">סיבת דחייה *</label>
                            <textarea class="form-control" id="rejectReason" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="button" class="btn btn-danger" id="saveRejectBtn">
                        <i class="fas fa-times"></i> דחה
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js?v=1.0.3"></script>
    <script src="js/common.js?v=1.0.3"></script>
    <script src="js/manager-dashboard.js?v=1.0.3"></script>
</body>
</html>

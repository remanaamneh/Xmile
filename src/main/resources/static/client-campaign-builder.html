<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>XMILE | יצירת הודעה</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="css/common.css"/>
  <link rel="stylesheet" href="styles/client-campaign-builder.css"/>
</head>
<body>
  <div class="page">
    <aside class="side">
      <div class="sideTitle">יצירת הודעה</div>
      <div class="steps">
        <div class="step active" data-step="1">1. בחר אירוע</div>
        <div class="step" data-step="2">2. בחר טקסט</div>
        <div class="step" data-step="3">3. עריכת טקסט</div>
        <div class="step" data-step="4">4. בחירת תמונה</div>
        <div class="step" data-step="5">5. ערוץ שליחה</div>
        <div class="step" data-step="6">6. סיכום ושליחה</div>
      </div>

      <button class="btn danger" id="btnBackDashboard">
        <i class="fas fa-arrow-right"></i> חזרה לדשבורד
      </button>
    </aside>

    <main class="content">
      <h2>יצירת הודעה למשתתפים</h2>
      <p class="muted">בחרי אירוע, טקסט, תמונה ואז שלחי.</p>

      <!-- STEP 1: Choose Event -->
      <section class="card stepPane" id="step1">
        <h3>בחרי אירוע</h3>
        <label class="lbl">אירוע:</label>
        <select id="eventSelect" class="form-select">
          <option value="">טוען אירועים...</option>
        </select>
        <label class="lbl">שם הודעה:</label>
        <input id="campaignName" class="form-control" placeholder="לדוגמה: עדכון חשוב לאירוע"/>
        
        <div class="nav">
          <button class="btn btn-primary" id="btn1Next">המשך</button>
        </div>
      </section>

      <!-- STEP 2: Choose AI Content -->
      <section class="card stepPane hidden" id="step2">
        <h3>שיפור הודעה למשתתפים באמצעות AI</h3>
        <p class="muted">כתבי הודעה ראשונית, וה-AI יציע לך 3 ניסוחים מקצועיים לבחירה</p>
        
        <div class="mb-3">
          <textarea id="aiPromptInput" class="form-control" rows="4" placeholder="לדוגמה: אנו שמחים להזמינכם לכנס השנתי שיתקיים ב־15.3 בתל אביב"></textarea>
          <button class="btn btn-info mt-2" id="btnGenerateAi">
            <i class="fas fa-magic"></i> שפרי את ההודעה עם AI
          </button>
        </div>

        <div id="aiOptionsSection" class="hidden">
          <div class="options-grid" id="contentOptionsGrid">
            <label class="option-card" data-index="0">
              <input type="radio" name="aiOption" value="0" class="option-radio" />
              <div class="option-title">
                <span class="option-checkmark">✓</span>
                <span class="option-label">מקצועית</span>
              </div>
              <div class="option-text" id="optText0"></div>
            </label>

            <label class="option-card" data-index="1">
              <input type="radio" name="aiOption" value="1" class="option-radio" />
              <div class="option-title">
                <span class="option-checkmark">✓</span>
                <span class="option-label">ידידותית</span>
              </div>
              <div class="option-text" id="optText1"></div>
            </label>

            <label class="option-card" data-index="2">
              <input type="radio" name="aiOption" value="2" class="option-radio" />
              <div class="option-title">
                <span class="option-checkmark">✓</span>
                <span class="option-label">שיווקית / חגיגית</span>
              </div>
              <div class="option-text" id="optText2"></div>
            </label>
          </div>
        </div>
        <div class="muted mt-2" id="loadingContent" style="display:none;">
          <i class="fas fa-spinner fa-spin"></i> יוצר תוכן...
        </div>
        
        <div class="mb-3 mt-3">
          <label class="lbl">הטקסט שנבחר:</label>
          <textarea id="finalMessageText" class="form-control" rows="3" placeholder="הטקסט הסופי יופיע כאן..." readonly></textarea>
        </div>

        <div class="nav">
          <button class="btn btn-secondary" id="btn2Back">חזור</button>
          <button class="btn btn-primary" id="btn2Next">המשך</button>
        </div>
      </section>

      <!-- STEP 3: Edit Content -->
      <section class="card stepPane hidden" id="step3">
        <h3>עריכת הטקסט</h3>
        <label class="lbl">נושא (למייל):</label>
        <input id="subject" class="form-control" placeholder="נושא הודעה"/>

        <label class="lbl">תוכן ההודעה (ניתן לעריכה):</label>
        <textarea id="messageText" class="form-control" rows="8" placeholder="כאן התוכן..."></textarea>

        <div class="nav">
          <button class="btn btn-secondary" id="btn3Back">חזור</button>
          <button class="btn btn-primary" id="btn3Next">המשך</button>
        </div>
      </section>

      <!-- STEP 4: Choose Template -->
      <section class="card stepPane hidden" id="step4">
        <h3>בחרי תמונה להודעה</h3>
        <p class="muted">בחרי תמונה אחת. היא תופיע בפוסטר/תצוגה מקדימה.</p>
        
        <div class="mb-3">
          <button class="btn btn-secondary" id="btnFindImages">
            <i class="fas fa-search"></i> חפש תמונות לפי הטקסט
          </button>
        </div>

        <div class="imgGrid" id="templateGrid"></div>
        <div class="muted mt-2" id="loadingTemplates" style="display:none;">
          <i class="fas fa-spinner fa-spin"></i> טוען תמונות...
        </div>

        <div class="previewRow">
          <div class="previewBox">
            <div class="previewTitle">תצוגה מקדימה</div>
            <img id="chosenImg" style="display:none;"/>
          </div>
        </div>

        <div class="nav">
          <button class="btn btn-secondary" id="btn4Back">חזור</button>
          <button class="btn btn-primary" id="btn4Next">המשך</button>
        </div>
      </section>

      <!-- STEP 5: Choose Channel -->
      <section class="card stepPane hidden" id="step5">
        <h3>בחרי ערוץ שליחה</h3>
        <div class="row">
          <button class="chip" data-chan="EMAIL">
            <i class="fas fa-envelope"></i> Email
          </button>
          <button class="chip" data-chan="WHATSAPP">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </button>
          <button class="chip" data-chan="SMS">
            <i class="fas fa-sms"></i> SMS
          </button>
        </div>

        <div class="nav">
          <button class="btn btn-secondary" id="btn5Back">חזור</button>
          <button class="btn btn-primary" id="btn5Next">המשך</button>
        </div>
      </section>

      <!-- STEP 6: Summary & Preview -->
      <section class="card stepPane hidden" id="step6">
        <h3>תצוגה מקדימה ושליחה</h3>

        <!-- Message Preview Tabs -->
        <div class="preview-section">
          <h4><i class="fas fa-eye"></i> תצוגה מקדימה</h4>
          
          <div class="preview-tabs">
            <button class="preview-tab active" data-preview="sms">
              <i class="fas fa-sms"></i> SMS
            </button>
            <button class="preview-tab" data-preview="email">
              <i class="fas fa-envelope"></i> Email
            </button>
            <button class="preview-tab" data-preview="whatsapp">
              <i class="fab fa-whatsapp"></i> WhatsApp
            </button>
          </div>

          <div class="preview-content">
            <div class="preview-pane active" id="previewPaneSMS">
              <div id="previewSMS" class="message-preview-card"></div>
            </div>
            <div class="preview-pane" id="previewPaneEmail">
              <div id="previewEmail" class="message-preview-card"></div>
            </div>
            <div class="preview-pane" id="previewPaneWhatsApp">
              <div id="previewWhatsApp" class="message-preview-card"></div>
            </div>
          </div>
        </div>

        <!-- Recipients Input -->
        <div class="mb-3">
          <label class="lbl">הוסף משתתפים (Email/Phone, אחד בכל שורה):</label>
          
          <div class="upload-row" style="margin:12px 0;">
            <label class="btn btn-outline-primary" style="cursor:pointer;">
              <i class="fas fa-file-excel"></i> העלאת קובץ Excel
              <input type="file" id="recipientsExcel" accept=".xlsx,.xls,.csv" hidden />
            </label>
            <small id="excelStatus" style="margin-right:10px;color:#6b7280;"></small>
          </div>
          
          <textarea id="recipientsList" class="form-control" rows="5" placeholder="user@example.com&#10;+972501234567"></textarea>
        </div>

        <button class="btn btn-success btn-lg w-100 mb-2" id="btnSend">
          <i class="fas fa-paper-plane"></i> 🚀 שליחה
        </button>
        <div class="muted text-center" id="sendStatus"></div>

        <div class="nav">
          <button class="btn btn-secondary" id="btn6Back">חזור</button>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/common.js"></script>
  <script src="js/client-campaign-builder.js"></script>
</body>
</html>

